<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
    <link rel="stylesheet" href="/css/styles.css?v=device_v8">
    <link rel="icon" type="image/x-icon" href="/favicon.ico?v=h3">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/h-logo-32.png?v=h3">
    <link rel="icon" type="image/svg+xml" href="/img/h-logo.svg?v=h3">
</head>
<body class="dashboard-bg">
<div class="shape shape-one"></div>
<div class="shape shape-two"></div>
<div class="container">
    <header class="dashboard-header">
        <div>
            <p class="eyebrow">KLH hackathon registration</p>
            <h1 class="page-title">Build Your Team. Secure Your Slot.</h1>
        </div>
        <div class="header-actions">
            <a id="headerLeaderboardLink" class="ghost-link hidden" href="/leaderboard">Leaderboard</a>
            <a class="ghost-link" href="/problem-statements">Problem Statements</a>
            <button class="danger-btn" onclick="logout()">Logout</button>
        </div>
    </header>

    <p id="userMessage" class="status-banner"></p>

    <section class="dashboard-grid">
        <article class="wizard-shell">
            <p id="registrationPolicyNote" class="policy-note hidden"></p>
            <div class="wizard-head">
                <div class="step" data-step="1">
                    <span>1</span>
                    <p>Choose Event</p>
                </div>
                <div class="step" data-step="2">
                    <span>2</span>
                    <p>Team & Form</p>
                </div>
                <div class="step" data-step="3">
                    <span>3</span>
                    <p>Review</p>
                </div>
                <div class="step" data-step="4">
                    <span>4</span>
                    <p>Pay & Finish</p>
                </div>
            </div>

            <div class="wizard-panel" id="step-1">
                <div class="section-title-row">
                    <h2>Available Events</h2>
                    <button onclick="loadEvents()">Refresh Events</button>
                </div>
                <div id="eventCards" class="event-cards"></div>
                <div id="selectedEventCard" class="selected-event hidden"></div>
                <div class="wizard-actions">
                    <button class="next-btn" onclick="nextStep()">Continue</button>
                </div>
            </div>

            <div class="wizard-panel hidden" id="step-2">
                <div class="section-title-row">
                    <h2>Team Registration</h2>
                    <button class="ghost-btn" onclick="saveDraft()">Save Draft</button>
                </div>

                <form id="teamRegistrationForm" class="stack">
                    <div>
                        <h3>Dynamic Registration Form</h3>
                        <div id="dynamicFieldsContainer" class="dynamic-grid"></div>
                    </div>

                    <div>
                        <div class="section-title-row">
                            <h3>Team Members</h3>
                            <button id="addMemberBtn" type="button" onclick="addMemberRow()">Add Member</button>
                        </div>
                        <p id="memberLimitHint" class="muted">Team size: minimum 1 member, maximum 4 members.</p>
                        <div id="membersContainer" class="member-cards"></div>
                    </div>

                    <div id="livePaymentPreview" class="upi-preview-box">
                        <h3>Live PhonePe Payment Preview</h3>
                        <p id="livePaymentAmount" class="muted">Payable Amount: INR 0.00</p>
                    </div>
                </form>

                <div class="wizard-actions">
                    <button class="ghost-btn" onclick="prevStep()">Back</button>
                    <button class="next-btn" onclick="nextStep()">Continue</button>
                </div>
            </div>

            <div class="wizard-panel hidden" id="step-3">
                <h2>Review Submission</h2>
                <div id="reviewContainer" class="review-grid"></div>
                <div class="wizard-actions">
                    <button class="ghost-btn" onclick="prevStep()">Back</button>
                    <button class="next-btn" onclick="submitRegistration()">Submit Registration</button>
                </div>
            </div>

            <div class="wizard-panel hidden" id="step-4">
                <h2>Payment and Confirmation</h2>
                <div id="teamConfirmation" class="team-confirmation"></div>
                <div id="paymentFlowView">
                    <div class="payment-box">
                        <label>Team ID
                            <input id="paymentTeamId" placeholder="Team ID" readonly>
                        </label>
                    </div>
                    <p id="phonePeAmountSummary" class="muted">Payable Amount: INR 0.00</p>
                    <div class="wizard-actions">
                        <button class="next-btn upi-intent-btn" type="button" onclick="startPhonePePayment()">Pay with PhonePe</button>
                        <button class="ghost-btn" type="button" onclick="checkPhonePePaymentStatus()">Check Payment Status</button>
                    </div>
                    <p class="muted">You will be redirected to PhonePe checkout. After payment, return to this page to view updated status.</p>
                </div>
                <div id="paymentSuccessView" class="thankyou-card hidden">
                    <h3>Thank You!</h3>
                    <p id="thankYouLine">Your payment was successful.</p>
                    <p id="thankYouTeam" class="muted"></p>
                    <div id="telegramJoinWrap" class="telegram-join-wrap hidden"></div>
                </div>
                <div class="wizard-actions">
                    <button class="ghost-btn" onclick="loadMyTeams()">Refresh Team Status</button>
                </div>
            </div>
        </article>

        <aside class="side-rail">
            <section class="side-card">
                <div class="section-title-row">
                    <h3>My Team</h3>
                    <button onclick="loadMyTeams()">Refresh</button>
                </div>
                <div id="myTeamsList" class="list-stack"></div>
            </section>

            <section class="side-card">
                <h3>More</h3>
                <p>Open the standalone page for released problem statements.</p>
                <div class="row top-gap">
                    <a id="sideLeaderboardLink" class="ghost-link hidden" href="/leaderboard">Leaderboard</a>
                    <a class="ghost-link" href="/problem-statements">Problem Statements</a>
                </div>
            </section>
        </aside>
    </section>
</div>
<script src="/js/common.js"></script>
<script src="/js/user.js?v=ready_v12"></script>
</body>
</html>
